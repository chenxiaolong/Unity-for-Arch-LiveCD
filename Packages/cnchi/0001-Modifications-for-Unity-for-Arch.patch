From e9e08581f6e8db203b0537c32fe6ac82c089bd9e Mon Sep 17 00:00:00 2001
From: Xiao-Long Chen <chenxiaolong@cxl.epac.to>
Date: Mon, 17 Jun 2013 13:04:10 -0400
Subject: [PATCH] Modifications for Unity-for-Arch

---
 cnchi.py                    |  13 +--
 data/packages.xml           | 170 ++++++++++++++++++++++++++----
 scripts/postinstall.sh      | 244 +++-----------------------------------------
 scripts/set-settings        | 146 --------------------------
 src/config.py               |   2 +-
 src/desktop.py              |  10 +-
 src/installation_process.py |  40 +++-----
 ui/check.ui                 |   1 +
 8 files changed, 198 insertions(+), 428 deletions(-)
 delete mode 100755 scripts/set-settings

diff --git a/cnchi.py b/cnchi.py
index 650cd03..07fef80 100755
--- a/cnchi.py
+++ b/cnchi.py
@@ -75,7 +75,7 @@ _enable_alongside = False
 
 # Enabled desktops
 #_desktops = [ "gnome", "cinnamon", "xfce", "razor", "openbox", "lxde", "enlightenment", "kde" ]
-_desktops = [ "gnome", "cinnamon", "xfce", "razor", "openbox" ]
+_desktops = [ "unity", "gnome", "cinnamon", "xfce", "razor", "openbox" ]
 
 # Useful vars for gettext (translations)
 APP = "cnchi"
@@ -393,11 +393,12 @@ if __name__ == '__main__':
         
     # Check if program needs to be updated
     if update:
-        upd = updater.Updater()
-        if upd.update():
-            logging.info("Program updated! Restarting...")
-            os.execl(sys.executable, *([sys.executable] + sys.argv))
-            sys.exit(0)
+        print('This version is patched for the Unity-for-Arch LiveCD and cannot use upstream\n'
+              'updates (unless you want a broken system). The LiveCD contains a repository\n'
+              'with automatically compiled updates. Just run:\n\n'
+              '  sudo pacman -Sy && sudo pacman -S cnchi\n\n'
+              'to update to the latest installer.')
+        sys.exit(1)
 
     
     # Start program #############################################
diff --git a/data/packages.xml b/data/packages.xml
index 12aac5c..ff1c479 100644
--- a/data/packages.xml
+++ b/data/packages.xml
@@ -1,11 +1,9 @@
 <?xml version="1.0" encoding="UTF-8"?>
-<!-- Preliminary xml file for Cnchi. This file is supposed to be in antergos server -->
 <packages>
 	<common_system>
 		<pkgname>base</pkgname> <!-- Group -->
 		<pkgname>base-devel</pkgname> <!-- Group -->
-		<pkgname>antergos-keyring</pkgname>
-		<pkgname>antergos-mirrorlist</pkgname>
+		<pkgname>bash-completion</pkgname>
 		<pkgname>haveged</pkgname>
 		<pkgname>crda</pkgname>
 		<pkgname>ipw2200-fw</pkgname>
@@ -21,7 +19,6 @@
 		<pkgname>alsa-utils</pkgname>
 		<pkgname>whois</pkgname>
 		<pkgname>dnsutils</pkgname>
-		<pkgname>transmission-cli</pkgname>
 		<pkgname>unzip</pkgname>
 		<pkgname>unrar</pkgname>
 		<pkgname>net-tools</pkgname>
@@ -32,12 +29,9 @@
 	<graphic_system>
 		<pkgname>xorg-server</pkgname>
 		<pkgname>xorg-server-utils</pkgname>
-		<pkgname>pacmanxg4</pkgname>
-		<pkgname>chromium</pkgname>
-		<pkgname>libreoffice-installer</pkgname>
-		<pkgname>faenza-hotot-icon</pkgname>
-		<pkgname>faenza-icon-theme</pkgname>
-		<pkgname>antergos-wallpapers</pkgname>
+		<!-- Chromium has no webapps support -->
+		<!-- <pkgname>chromium</pkgname> -->
+		<pkgname>firefox</pkgname>
 		<pkgname>xf86-input-synaptics</pkgname>
 	</graphic_system>
 
@@ -59,7 +53,6 @@
 		<pkgname>empathy</pkgname>
 		<pkgname>transmission-gtk</pkgname>
 		<pkgname>xnoise</pkgname>
-		<pkgname>hotot-gtk3</pkgname>
 		<pkgname>shotwell</pkgname>
 		<pkgname>gnome-themes-standard</pkgname>
 		<pkgname>hicolor-icon-theme</pkgname>
@@ -69,7 +62,6 @@
 		<pkgname>gnome-shell</pkgname>
 		<pkgname>gnome-control-center</pkgname>
 		<pkgname>nautilus</pkgname>
-		<pkgname>zukitwo-themes</pkgname>
 		<pkgname>gstreamer0.10-bad-plugins</pkgname>
 		<pkgname>gstreamer0.10-base-plugins</pkgname>
 		<pkgname>gstreamer0.10-ffmpeg</pkgname>
@@ -95,7 +87,6 @@
 		<pkgname>empathy</pkgname>
 		<pkgname>transmission-gtk</pkgname>
 		<pkgname>xnoise</pkgname>
-		<pkgname>hotot-gtk3</pkgname>
 		<pkgname>shotwell</pkgname>
 		<pkgname>gnome-themes-standard</pkgname>
 		<pkgname>hicolor-icon-theme</pkgname>
@@ -106,13 +97,11 @@
 		<pkgname>cinnamon-control-center</pkgname>
 		<pkgname>cinnamon-screensaver</pkgname>
 		<pkgname>nemo</pkgname>
-		<pkgname>zukitwo-themes</pkgname>
 		<pkgname>gstreamer0.10-bad-plugins</pkgname>
 		<pkgname>gstreamer0.10-base-plugins</pkgname>
 		<pkgname>gstreamer0.10-ffmpeg</pkgname>
 		<pkgname>gstreamer0.10-good-plugins</pkgname>
 		<pkgname>gst-libav</pkgname>
-		<pkgname>cinnamon-theme-nadia</pkgname>
 	</cinnamon_desktop>
 
 	<xfce_desktop>
@@ -134,14 +123,12 @@
 		<pkgname>transmission-gtk</pkgname>
 		<pkgname>pidgin</pkgname>
 		<pkgname>gnome-calculator</pkgname>
-		<pkgname>zukitwo-themes</pkgname>
 		<pkgname>gstreamer0.10-bad-plugins</pkgname>
 		<pkgname>gstreamer0.10-base-plugins</pkgname>
 		<pkgname>gstreamer0.10-ffmpeg</pkgname>
 		<pkgname>gstreamer0.10-good-plugins</pkgname>
 		<pkgname>gst-libav</pkgname>
 		<pkgname>xdg-user-dirs-gtk</pkgname>
-		<pkgname>hotot-gtk3</pkgname>
 	</xfce_desktop>
 
 	<razor_desktop>
@@ -163,7 +150,6 @@
 		<pkgname>kdegraphics-ksnapshot</pkgname>
 		<pkgname>transmission-qt</pkgname>
 		<pkgname>phonon-vlc</pkgname>
-		<pkgname>hotot-qt</pkgname>
 	</razor_desktop>
 
 	<openbox_desktop>
@@ -183,7 +169,6 @@
 		<pkgname nm='true' name='NetworkManager'>network-manager-applet</pkgname>
                 <pkgname>sakura</pkgname>
                 <pkgname>mousepad</pkgname>
-                <pkgname>zukitwo-theme-openbox</pkgname>
                 <pkgname>openbox-menu</pkgname>
                 <pkgname>compton</pkgname>
                 <pkgname>xorg-xinit</pkgname>
@@ -192,11 +177,152 @@
                 <pkgname>slimlock</pkgname>
         </openbox_desktop>
 
-	<!-- Third party software. Some of it is propietary -->
-	<third_party>
+	<unity_desktop>
+		<!-- Unity-for-Arch -->
+		<pkgname>bamf</pkgname>
+		<pkgname>compiz-ubuntu</pkgname>
+		<pkgname>credentials-preferences-ubuntu</pkgname>
+		<pkgname>evemu</pkgname>
+		<pkgname>frame</pkgname>
+		<pkgname>geis</pkgname>
+		<pkgname>gnome-control-center-ubuntu</pkgname>
+		<pkgname>gnome-control-center-unity</pkgname>
+		<pkgname>gnome-screensaver-ubuntu</pkgname>
+		<pkgname>gnome-session-ubuntu</pkgname>
+		<pkgname>gnome-settings-daemon-ubuntu</pkgname>
+		<pkgname>grail</pkgname>
+		<pkgname>gsettings-desktop-schemas-ubuntu</pkgname>
+		<pkgname>gtk2-ubuntu</pkgname>
+		<pkgname>gtk3-ubuntu</pkgname>
+		<pkgname>hud</pkgname>
+		<pkgname>ido</pkgname>
+		<pkgname>indicator-applet</pkgname>
+		<pkgname>indicator-application</pkgname>
+		<pkgname>indicator-appmenu</pkgname>
+		<pkgname>indicator-bluetooth</pkgname>
+		<pkgname>indicator-datetime</pkgname>
+		<pkgname>indicator-messages</pkgname>
+		<pkgname>indicator-power</pkgname>
+		<pkgname>indicator-printers</pkgname>
+		<pkgname>indicator-session</pkgname>
+		<pkgname>indicator-sound</pkgname>
+		<pkgname>libappindicator</pkgname>
+		<pkgname>libappindicator3</pkgname>
+		<pkgname>libdbusmenu</pkgname>
+		<pkgname>libdbusmenu-gtk2</pkgname>
+		<pkgname>libdbusmenu-gtk3</pkgname>
+		<pkgname>libindicate</pkgname>
+		<pkgname>libindicate-gtk2</pkgname>
+		<pkgname>libindicate-gtk3</pkgname>
+		<!-- <pkgname>libindicate-qt</pkgname> -->
+		<pkgname>libindicator</pkgname>
+		<pkgname>libindicator3</pkgname>
+		<pkgname>liboverlay-scrollbar</pkgname>
+		<pkgname>liboverlay-scrollbar3</pkgname>
+		<pkgname>libunity</pkgname>
+		<pkgname>libunity-misc</pkgname>
+		<pkgname>libunity-webapps</pkgname>
+		<pkgname>metacity-ubuntu</pkgname>
+		<pkgname>nautilus-ubuntu</pkgname>
+		<pkgname nm='true' name='NetworkManager'>network-manager-applet-ubuntu</pkgname>
+		<pkgname>nux</pkgname>
+		<pkgname>overlay-scrollbar</pkgname>
+		<pkgname>python-oauthlib</pkgname>
+		<!-- <pkgname>sni-qt</pkgname> -->
+		<pkgname>unity</pkgname>
+		<pkgname>unity-asset-pool</pkgname>
+		<pkgname>unity-gtk-module</pkgname>
+		<pkgname>unity-lens-applications</pkgname>
+		<pkgname>unity-lens-files</pkgname>
+		<pkgname>unity-lens-music</pkgname>
+		<pkgname>unity-lens-photos</pkgname>
+		<pkgname>unity-lens-video</pkgname>
+		<pkgname>unity-scopes</pkgname>
+
+		<!-- Unity-for-Arch-Extra -->
+		<pkgname>accountsservice-ubuntu</pkgname>
+		<!-- <pkgname>chromium-extension-webaccounts</pkgname> -->
+		<pkgname>empathy-ubuntu</pkgname>
+		<pkgname>firefox-extension-unity</pkgname>
+		<pkgname>firefox-extension-webaccounts</pkgname>
+		<pkgname>firefox-extension-websites-integration</pkgname>
+		<pkgname>firefox-globalmenu</pkgname>
+		<pkgname>humanity-icon-theme</pkgname>
+		<!-- <pkgname>indicator-cpufreq</pkgname> -->
+		<!-- <pkgname>indicator-sync</pkgname> -->
+		<pkgname>libpam-freerdp</pkgname>
+		<!-- <pkgname>libreoffice-extension-menubar</pkgname> -->
+		<!-- <pkgname>liferea-indicator</pkgname> -->
+		<pkgname>lightdm-remote-session-freerdp</pkgname>
+		<pkgname>lightdm-remote-session-uccsconfigure</pkgname>
+		<pkgname dm='true' name='lightdm'>lightdm-ubuntu</pkgname>
+		<pkgname>lightdm-unity-greeter</pkgname>
+		<!-- <pkgname>pidgin-libnotify-ubuntu</pkgname> -->
+		<!-- <pkgname>plasma-widget-menubar</pkgname> -->
+		<pkgname>python-polib</pkgname>
+		<pkgname>python3-pycurl</pkgname>
+		<pkgname>remote-login-service</pkgname>
+		<pkgname>telepathy-indicator</pkgname>
+		<pkgname>thin-client-config-agent</pkgname>
+		<!-- <pkgname>thunderbird-globalmenu</pkgname> -->
+		<!-- <pkgname>thunderbird-messagingmenu</pkgname> -->
+		<pkgname>ubuntu-sounds</pkgname>
+		<pkgname>ubuntu-themes</pkgname>
+		<pkgname>ubuntu-wallpapers</pkgname>
+		<pkgname>unity-tweak-tool</pkgname>
+		<pkgname>unity-webapps</pkgname>
+		<pkgname>webaccounts-browser-extension</pkgname>
+		<pkgname>webapps-applications</pkgname>
+		<!-- <pkgname>xfce4-indicator-plugin</pkgname> -->
+
+		<!-- Required GNOME packages -->
+		<!-- <pkgname>gnome-backgrounds</pkgname> -->
+		<pkgname>gnome-desktop</pkgname>
+		<pkgname>gnome-icon-theme</pkgname>
+		<pkgname>gnome-icon-theme-extras</pkgname>
+		<pkgname>gnome-icon-theme-symbolic</pkgname>
+		<pkgname>gnome-terminal</pkgname>
+		<pkgname>gnome-themes-standard</pkgname>
+		<pkgname>xdg-user-dirs-gtk</pkgname>
+
+		<!-- Other GNOME packages -->
+		<pkgname>eog</pkgname>
+		<pkgname>evince</pkgname>
+		<pkgname>file-roller</pkgname>
+		<pkgname>gedit</pkgname>
+		<pkgname>gnome-bluetooth</pkgname>
+		<pkgname>gnome-calculator</pkgname>
+		<pkgname>gnome-keyring</pkgname>
+		<pkgname>gnome-power-manager</pkgname>
+		<pkgname>gnome-screenshot</pkgname>
+		<pkgname>gnome-system-monitor</pkgname>
+		<pkgname>gnome-tweak-tool</pkgname>
+
+		<!-- Fonts -->
+		<pkgname>ttf-dejavu</pkgname>
+		<pkgname>ttf-ubuntu-font-family</pkgname>
+
+		<!-- Cursors -->
+		<pkgname>xcursor-vanilla-dmz</pkgname>
+
+		<!-- Desktop applications -->
+		<pkgname>firefox</pkgname>
+		<!-- <pkgname>thunderbird</pkgname> -->
+
+		<!-- Other stuff -->
+		<pkgname>networkmanager</pkgname>
+		<pkgname>pulseaudio</pkgname>
+		<pkgname>gparted</pkgname>
+
+		<!-- Default settings -->
+		<pkgname>ubuntu-default-settings</pkgname>
+	</unity_desktop>
+
+	<!-- Not everyone wants closed source software by default -->
+	<!--<third_party>
 		<pkgname>flashplugin</pkgname>
 		<pkgname>gstreamer0.10-ugly-plugins</pkgname>
-	</third_party>
+	</third_party>-->
 
 	<graphics>
 		<nvidia>
diff --git a/scripts/postinstall.sh b/scripts/postinstall.sh
index 78f0ed5..f37ee13 100755
--- a/scripts/postinstall.sh
+++ b/scripts/postinstall.sh
@@ -1,222 +1,11 @@
-set_synaptics()
-{
-    cat << EOF > ${DESTDIR}/etc/X11/xorg.conf.d/50-synaptics.conf 
-# Example xorg.conf.d snippet that assigns the touchpad driver
-# to all touchpads. See xorg.conf.d(5) for more information on
-# InputClass.
-# DO NOT EDIT THIS FILE, your distribution will likely overwrite
-# it when updating. Copy (and rename) this file into
-# /etc/X11/xorg.conf.d first.
-# Additional options may be added in the form of
-#   Option "OptionName" "value"
-#
-Section "InputClass"
-        Identifier "touchpad catchall"
-        Driver "synaptics"
-        MatchIsTouchpad "on"
-        Option "TapButton1" "1"
-        Option "TapButton2" "2"
-        Option "TapButton3" "3"
-# This option is recommend on all Linux systems using evdev, but cannot be
-# enabled by default. See the following link for details:
-# http://who-t.blogspot.com/2010/11/how-to-ignore-configuration-errors.html
-        MatchDevicePath "/dev/input/event*"
-EndSection
-
-Section "InputClass"
-        Identifier "touchpad ignore duplicates"
-        MatchIsTouchpad "on"
-        MatchOS "Linux"
-        MatchDevicePath "/dev/input/mouse*"
-        Option "Ignore" "on"
-EndSection
-
-# This option enables the bottom right corner to be a right button on
-# non-synaptics clickpads.
-# This option is only interpreted by clickpads.
-Section "InputClass"
-        Identifier "Default clickpad buttons"
-        MatchDriver "synaptics"
-        Option "SoftButtonAreas" "50% 0 82% 0 0 0 0 0"
-EndSection
-
-# This option disables software buttons on Apple touchpads.
-# This option is only interpreted by clickpads.
-Section "InputClass"
-        Identifier "Disable clickpad buttons on Apple touchpads"
-        MatchProduct "Apple|bcm5974"
-        MatchDriver "synaptics"
-        Option "SoftButtonAreas" "0 0 0 0 0 0 0 0"
-EndSection
-EOF
-
-}
-
-gnome_settings(){
-	# Set Adwaita cursor theme
-	chroot ${DESTDIR} ln -s /usr/share/icons/Adwaita /usr/share/icons/default
-
-	# Set gsettings input-source
-	if [[ "${KEYBOARD_VARIANT}" != '' ]];then
-		sed -i "s/'us'/'${KEYBOARD_LAYOUT}+${KEYBOARD_VARIANT}'/" /usr/share/cnchi/scripts/set-settings
-	else
-		sed -i "s/'us'/'${KEYBOARD_LAYOUT}'/" /usr/share/cnchi/scripts/set-settings
-        fi
+unity_settings(){
 	# Set gsettings
-	cp /usr/share/cnchi/scripts/set-settings ${DESTDIR}/usr/bin/set-settings
-	mkdir -p ${DESTDIR}/var/run/dbus
-	mount -o bind /var/run/dbus ${DESTDIR}/var/run/dbus
-	chroot ${DESTDIR} su -c "/usr/bin/set-settings ${DESKTOP}" ${USER_NAME} >/dev/null 2>&1
-	rm ${DESTDIR}/usr/bin/set-settings
+	#mkdir -p ${DESTDIR}/var/run/dbus
+	#mount -o bind /var/run/dbus ${DESTDIR}/var/run/dbus
+	#chroot ${DESTDIR} su -c "dbus-launch gsettings set org.gnome.desktop.input-sources sources \"[('xkb','${LANG_CODE}')]\"" ${USER_NAME}
 
-	# Set skel directory
-	cp -R ${DESTDIR}/home/${USER_NAME}/.config ${DESTDIR}/etc/skel
-
-	## Set defaults directories
-	chroot ${DESTDIR} su -c xdg-user-dirs-update ${USER_NAME}
-}
-
-cinnamon_settings(){
-	# Set Adwaita cursor theme
-	chroot ${DESTDIR} ln -s /usr/share/icons/Adwaita /usr/share/icons/default
-
-	# Set gsettings input-source
-	if [[ "${KEYBOARD_VARIANT}" != '' ]];then
-		sed -i "s/'us'/'${KEYBOARD_LAYOUT}+${KEYBOARD_VARIANT}'/" /usr/share/cnchi/scripts/set-settings
-	else
-		sed -i "s/'us'/'${KEYBOARD_LAYOUT}'/" /usr/share/cnchi/scripts/set-settings
-        fi
-	# copy antergos menu icon
-	mkdir -p ${DESTDIR}/usr/share/antergos/
-	cp /usr/share/antergos/antergos-menu.png ${DESTDIR}/usr/share/antergos/antergos-menu.png
-
-	# Set gsettings
-	cp /usr/share/cnchi/scripts/set-settings ${DESTDIR}/usr/bin/set-settings
-	mkdir -p ${DESTDIR}/var/run/dbus
-	mount -o bind /var/run/dbus ${DESTDIR}/var/run/dbus
-	chroot ${DESTDIR} su -c "/usr/bin/set-settings ${DESKTOP}" ${USER_NAME} >/dev/null 2>&1
-	rm ${DESTDIR}/usr/bin/set-settings
-
-	# Set Cinnamon in .dmrc
-	echo "[Desktop]" > ${DESTDIR}/home/${USER_NAME}/.dmrc
-	echo "Session=cinnamon" >> ${DESTDIR}/home/${USER_NAME}/.dmrc
-
-	# Set skel directory
-	cp -R ${DESTDIR}/home/${USER_NAME}/.config ${DESTDIR}/etc/skel
-
-	## Set defaults directories
-	chroot ${DESTDIR} su -c xdg-user-dirs-update ${USER_NAME}
-}
-
-xfce_settings(){
-	# Set Adwaita cursor theme
-	chroot ${DESTDIR} ln -s /usr/share/icons/Adwaita /usr/share/icons/default
-
-	# copy antergos menu icon
-	mkdir -p ${DESTDIR}/usr/share/antergos/
-	cp /usr/share/antergos/antergos-menu.png ${DESTDIR}/usr/share/antergos/antergos-menu.png
-
-	# Set settings
-	mkdir -p ${DESTDIR}/home/${USER_NAME}/.config/xfce4/xfconf/xfce-perchannel-xml
-	cp -R ${DESTDIR}/etc/xdg/xfce4/panel ${DESTDIR}/etc/xdg/xfce4/helpers.rc ${DESTDIR}/home/${USER_NAME}/.config/xfce4
-	sed -i "s/WebBrowser=firefox/WebBrowser=chromium/" ${DESTDIR}/home/${USER_NAME}/.config/xfce4/helpers.rc
-	chroot ${DESTDIR} chown -R ${USER_NAME}:users /home/${USER_NAME}/.config
-	cp /usr/share/cnchi/scripts/set-settings ${DESTDIR}/usr/bin/set-settings
-	mkdir -p ${DESTDIR}/var/run/dbus
-	mount -o bind /var/run/dbus ${DESTDIR}/var/run/dbus
-	chroot ${DESTDIR} su -c "/usr/bin/set-settings ${DESKTOP}" ${USER_NAME} >/dev/null 2>&1
-	rm ${DESTDIR}/usr/bin/set-settings
-
-	# Set skel directory
-	cp -R ${DESTDIR}/home/${USER_NAME}/.config ${DESTDIR}/etc/skel
-
-	## Set defaults directories
-	chroot ${DESTDIR} su -c xdg-user-dirs-update ${USER_NAME}
-
-	# Set xfce in .dmrc
-	echo "[Desktop]" > ${DESTDIR}/home/${USER_NAME}/.dmrc
-	echo "Session=xfce" >> ${DESTDIR}/home/${USER_NAME}/.dmrc
-}
-
-openbox_settings(){
-	# Set Adwaita cursor theme
-	chroot ${DESTDIR} ln -s /usr/share/icons/Adwaita /usr/share/icons/default
-
-	# copy antergos menu icon
-	mkdir -p ${DESTDIR}/usr/share/antergos/
-	cp /usr/share/antergos/antergos-menu.png ${DESTDIR}/usr/share/antergos/antergos-menu.png
-
-	# Set settings
-    
-    # Get zip file from github, unzip it and copy all setup files in their right places.
-    mkdir -p ${DESTDIR}/tmp
-    wget -q -O ${DESTDIR}/tmp/master.zip "https://github.com/Antergos/openbox-setup/archive/master.zip"
-    unzip -d ${DESTDIR}/tmp ${DESTDIR}/tmp/master.zip
-    # copy slim theme
-    mkdir -p ${DESTDIR}/usr/share/slim/themes/antergos-slim
-    cp ${DESTDIR}/tmp/openbox-setup-master/antergos-slim/* ${DESTDIR}/usr/share/slim/themes/antergos-slim
-    # copy home files
-    cp ${DESTDIR}/tmp/openbox-setup-master/gtkrc-2.0 ${DESTDIR}/home/${USER_NAME}/.gtkrc-2.0
-	chroot ${DESTDIR} chown -R ${USER_NAME}:users /home/${USER_NAME}/.gtkrc-2.0  
-    cp ${DESTDIR}/tmp/openbox-setup-master/xinitrc ${DESTDIR}/home/${USER_NAME}/.xinitrc
-    chroot ${DESTDIR} chown -R ${USER_NAME}:users /home/${USER_NAME}/.xinitrc
-    
-    # copy .config files
-    mkdir -p ${DESTDIR}/home/${USER_NAME}/.config
-    cp -R ${DESTDIR}/tmp/openbox-setup-master/config/* ${DESTDIR}/home/${USER_NAME}/.config
-    # copy /etc setup files
-    cp -R ${DESTDIR}/tmp/openbox-setup-master/etc/* ${DESTDIR}/etc
-	
-    chroot ${DESTDIR} chown -R ${USER_NAME}:users /home/${USER_NAME}/.config
-	cp /usr/share/cnchi/scripts/set-settings ${DESTDIR}/usr/bin/set-settings
-	mkdir -p ${DESTDIR}/var/run/dbus
-	mount -o bind /var/run/dbus ${DESTDIR}/var/run/dbus
-	chroot ${DESTDIR} su -c "/usr/bin/set-settings ${DESKTOP}" ${USER_NAME} >/dev/null 2>&1
-	rm ${DESTDIR}/usr/bin/set-settings
-    
-    # remove leftovers
-    rm -f ${DESTDIR}/tmp/master.zip
-    rm -rf ${DESTDIR}/tmp/openbox-setup-master
-
-	# Set skel directory
-	cp -R ${DESTDIR}/home/${USER_NAME}/.config ${DESTDIR}/etc/skel
-
-	## Set defaults directories
-	#chroot ${DESTDIR} su -c xdg-user-dirs-update ${USER_NAME}
-
-	# Set openbox in .dmrc
-	echo "[Desktop]" > ${DESTDIR}/home/${USER_NAME}/.dmrc
-	echo "Session=openbox" >> ${DESTDIR}/home/${USER_NAME}/.dmrc
-}
-
-razor_settings(){
-	# Set theme
-	mkdir -p ${DESTDIR}/home/${USER_NAME}/.config/razor/razor-panel
-	echo "[General]" > ${DESTDIR}/home/${USER_NAME}/.config/razor/razor.conf
-	echo "__userfile__=true" >> ${DESTDIR}/home/${USER_NAME}/.config/razor/razor.conf
-	echo "icon_theme=Faenza" >> ${DESTDIR}/home/${USER_NAME}/.config/razor/razor.conf
-	echo "theme=ambiance" >> ${DESTDIR}/home/${USER_NAME}/.config/razor/razor.conf
-
-	# Set panel launchers
-	echo "[quicklaunch]" >> ${DESTDIR}/home/${USER_NAME}/.config/razor/razor-panel/panel.conf
-	echo "apps\1\desktop=/usr/share/applications/razor-config.desktop" >> ${DESTDIR}/home/${USER_NAME}/.config/razor/razor-panel/panel.conf
-	echo "apps\size=3" >> ${DESTDIR}/home/${USER_NAME}/.config/razor/razor-panel/panel.conf
-	echo "apps\2\desktop=/usr/share/applications/kde4/konsole.desktop" >> ${DESTDIR}/home/${USER_NAME}/.config/razor/razor-panel/panel.conf
-	echo "apps\3\desktop=/usr/share/applications/chromium.desktop" >> ${DESTDIR}/home/${USER_NAME}/.config/razor/razor-panel/panel.conf
-
-	# Set Wallpaper
-	echo "[razor]" >> ${DESTDIR}/home/${USER_NAME}/.config/razor/desktop.conf
-	echo "screens\size=1" >> ${DESTDIR}/home/${USER_NAME}/.config/razor/desktop.conf
-	echo "screens\1\desktops\1\wallpaper_type=pixmap" >> ${DESTDIR}/home/${USER_NAME}/.config/razor/desktop.conf
-	echo "screens\1\desktops\1\wallpaper=/usr/share/antergos/wallpapers/antergos-wallpaper.png" >> ${DESTDIR}/home/${USER_NAME}/.config/razor/desktop.conf
-	echo "screens\1\desktops\1\keep_aspect_ratio=false" >> ${DESTDIR}/home/${USER_NAME}/.config/razor/desktop.conf
-	echo "screens\1\desktops\size=1" >> ${DESTDIR}/home/${USER_NAME}/.config/razor/desktop.conf
-
-	# Set Razor in .dmrc
-	echo "[Desktop]" > ${DESTDIR}/home/${USER_NAME}/.dmrc
-	echo "Session=razor" >> ${DESTDIR}/home/${USER_NAME}/.dmrc
-	
-	chroot ${DESTDIR} chown -R ${USER_NAME}:users /home/${USER_NAME}/.config
+	echo '[Desktop]' > ${DESTDIR}/home/${USER_NAME}/.dmrc
+	echo 'Session=ubuntu' >> ${DESTDIR}/home/${USER_NAME}/.dmrc
 }
 
 nox_settings(){
@@ -235,20 +24,19 @@ postinstall(){
 	"${DESKTOP}_settings"
 
 	## Unmute alsa channels
-	chroot ${DESTDIR} amixer -c 0 set Master playback 100% unmute>/dev/null 2>&1
+	#chroot ${DESTDIR} amixer -c 0 set Master playback 100% unmute>/dev/null 2>&1
 
-	# Fix transmission leftover
-    if [ -f ${DESTDIR}/usr/lib/tmpfiles.d/transmission.conf ];
-    then
-	    mv ${DESTDIR}/usr/lib/tmpfiles.d/transmission.conf ${DESTDIR}/usr/lib/tmpfiles.d/transmission.conf.backup
-    fi
+	# Add Unity-for-Arch repositories by default
+	cat >> ${DESTDIR}/etc/pacman.conf << EOF
 
-	# Configure touchpad
-	set_synaptics
+[Unity-for-Arch]
+SigLevel = Optional TrustAll
+Server = http://dl.dropbox.com/u/486665/Repos/Unity-for-Arch/\$arch
 
-	# Set Antergos name in filesystem files
-	cp /etc/arch-release ${DESTDIR}/etc
-	cp -f /etc/os-release ${DESTDIR}/etc/os-release
+[Unity-for-Arch-Extra]
+SigLevel = Optional TrustAll
+Server = http://dl.dropbox.com/u/486665/Repos/Unity-for-Arch-Extra/\$arch
+EOF
 }
 
 touch /tmp/.postinstall.lock
diff --git a/scripts/set-settings b/scripts/set-settings
deleted file mode 100755
index 889a5d8..0000000
--- a/scripts/set-settings
+++ /dev/null
@@ -1,146 +0,0 @@
-#!/bin/bash
-
-DESKTOP=$1
-
-# Change keyboard layaout
-dbus-launch gsettings set org.gnome.desktop.input-sources sources "[('xkb','us')]"
-
-# Set gtk theme
-dbus-launch gsettings set org.gnome.desktop.interface gtk-theme Zukitwo
-dbus-launch gsettings set org.gnome.desktop.wm.preferences theme Zukitwo
-
-if [[ ${DESKTOP} == 'gnome' ]];then
-
-	# Set favorite apps
-	dbus-launch gsettings set org.gnome.shell favorite-apps "['nautilus.desktop', 'chromium.desktop', 'empathy.desktop', 'xnoise.desktop']"
-
-	# Change default wallpaper
-	dbus-launch gsettings set org.gnome.desktop.background picture-uri file:///usr/share/antergos/wallpapers/antergos-wallpaper.png
-
-	# Set GTK Theme
-	dbus-launch gsettings set org.gnome.desktop.interface gtk-theme Zukitwo
-	dbus-launch gsettings set org.gnome.desktop.wm.preferences theme Zukitwo
-
-	# Set icon theme
-	dbus-launch gsettings set org.gnome.desktop.interface icon-theme Faenza-Dark
-
-fi
-
-if [[ ${DESKTOP} == 'cinnamon' ]];then
-
-	# Set menu icon
-	dbus-launch gsettings set org.cinnamon menu-icon "/usr/share/antergos/antergos-menu.png"
-
-	# Set favorite apps
-	dbus-launch gsettings set org.cinnamon favorite-apps "['nemo.desktop', 'chromium.desktop', 'xnoise.desktop']"
-
-	# Set overview corner to false
-	dbus-launch gsettings set org.cinnamon overview-corner "['false:false:false', 'false:false:false', 'false:false:false', 'false:false:false']"
-
-	# Set panel launchers
-	dbus-launch gsettings set org.cinnamon panel-launchers "['chromium.desktop', 'nemo.desktop', 'gnome-terminal.desktop']"
-
-	# Set panel orientation
-	dbus-launch gsettings set org.cinnamon desktop-layout "flipped"
-
-	# Set enabled applets
-	dbus-launch gsettings set org.cinnamon enabled-applets "['panel1:left:1:menu@cinnamon.org:0', 'panel1:left:2:panel-launchers@cinnamon.org:1', 'panel1:left:3:window-list@cinnamon.org:2', 'panel1:right:0:removable-drives@cinnamon.org:3', 'panel1:right:1:keyboard@cinnamon.org:4', 'panel1:right:2:bluetooth@cinnamon.org:5', 'panel1:right:4:systray@cinnamon.org:7', 'panel1:right:5:power@cinnamon.org:8', 'panel1:right:6:network@cinnamon.org:6', 'panel1:right:7:sound@cinnamon.org:9', 'panel1:right:8:calendar@cinnamon.org:10', 'panel1:right:9:settings@cinnamon.org:11']"
-
-	# Disable keyboard flags
-	dbus-launch gsettings set org.cinnamon keyboard-applet-use-flags "false"
-	
-	# Set background
-	dbus-launch gsettings set org.cinnamon.background picture-uri file:///usr/share/antergos/wallpapers/antergos-wallpaper.png
-	dbus-launch gsettings set org.gnome.desktop.background picture-uri file:///usr/share/antergos/wallpapers/antergos-wallpaper.png
-
-	# Set theme
-	dbus-launch gsettings set org.cinnamon.theme name "Nadia"
-
-	# Set GTK Theme
-	dbus-launch gsettings set org.gnome.desktop.interface gtk-theme Zukitwo
-	dbus-launch gsettings set org.gnome.desktop.wm.preferences theme Zukitwo
-
-	# Set icon theme
-	dbus-launch gsettings set org.gnome.desktop.interface icon-theme Faenza-Dark
-
-fi
-
-if [[ ${DESKTOP} == 'xfce' ]];then
-
-	touch ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-desktop.xml
-	touch ~/.config/xfce4/xfconf/xfce-perchannel-xml/xsettings.xml
-	touch ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-panel.xml
-	touch ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfwm4.xml
-
-
-	# Set background
-	dbus-launch xfconf-query -c xfce4-desktop -p /backdrop/screen0/monitor0/image-path -n -t string -s "/usr/share/antergos/wallpapers/antergos-wallpaper.png"
-	CMD=`grep image-path ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-desktop.xml`
-	while [ "${CMD}" == "" ]; do
-	    sleep 3
-		CMD=`grep image-path ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-desktop.xml`
-	done
-
-	# Set theme
-	CMD=`grep image-path ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-desktop.xml`
-	while [ "${CMD}" == "" ]; do
-	    sleep 3
-		CMD=`grep image-path ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-desktop.xml`
-	done
-	dbus-launch xfconf-query -c xsettings -p /Net/ThemeName -n -t string -s "Zukitwo"
-
-	CMD=`grep ThemeName ~/.config/xfce4/xfconf/xfce-perchannel-xml/xsettings.xml`
-	while [ "${CMD}" == "" ]; do
-        sleep 3
-		CMD=`grep ThemeName ~/.config/xfce4/xfconf/xfce-perchannel-xml/xsettings.xml`
-	done
-	dbus-launch xfconf-query -c xfwm4 -p /general/theme -n -t string -s "Zukitwo"
-
-	# Set icon theme
-	CMD=`grep theme ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfwm4.xml`
-	while [ "${CMD}" == "" ]; do
-        sleep 3
-		CMD=`grep theme ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfwm4.xml`
-	done
-	dbus-launch xfconf-query -c xsettings -p /Net/IconThemeName -n -t string -s "Faenza-Dark"
-
-	# Set compositor
-	CMD=`grep IconThemeName ~/.config/xfce4/xfconf/xfce-perchannel-xml/xsettings.xml`
-	while [ "${CMD}" == "" ]; do
-        sleep 3
-		CMD=`grep IconThemeName ~/.config/xfce4/xfconf/xfce-perchannel-xml/xsettings.xml`
-	done
-	dbus-launch xfconf-query -c xfwm4 -p /general/show_frame_shadow -n -t bool -s "true"
-
-	# Set workspaces count
-	CMD=`grep show_frame_shadow ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfwm4.xml`
-	while [ "${CMD}" == "" ]; do
-        sleep 3
-		CMD=`grep show_frame_shadow ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfwm4.xml`
-	done
-	dbus-launch xfconf-query -c xfwm4 -p /general/workspace_count -n -t int -s 2
-
-	# Set panels
-	CMD=`grep workspace_count ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfwm4.xml`
-	while [ "${CMD}" == "" ]; do
-        sleep 3
-		CMD=`grep workspace_count ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfwm4.xml`
-	done
-	dbus-launch xfconf-query -c xfce4-panel -p /panels/panel-2/autohide -n -t bool -s "true"
-
-	CMD=`grep autohide ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-panel.xml`
-	while [ "${CMD}" == "" ]; do
-        sleep 3
-		CMD=`grep autohide ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-panel.xml`
-	done
-	dbus-launch xfconf-query -c xfce4-panel -p /panels/panel-1/size -n -t int -s 25
-
-	# Set menu logo
-	CMD=`grep size ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-panel.xml`
-	while [ "${CMD}" == "" ]; do
-        sleep 3
-		CMD=`grep size ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-panel.xml`
-	done
-	dbus-launch xfconf-query -c xfce4-panel -p /plugins/plugin-1/button-icon -n -t string -s "/usr/share/antergos/antergos-menu.png"
-fi
-
diff --git a/src/config.py b/src/config.py
index bd20568..dffbefe 100644
--- a/src/config.py
+++ b/src/config.py
@@ -58,7 +58,7 @@ class Settings():
             'use_ntp' : True, \
             'third_party_software' : False, \
             'desktops' : [], \
-            'desktop' : 'gnome', \
+            'desktop' : 'unity', \
             'partition_mode' : 'easy', \
             'auto_device' : '/dev/sda', \
             'log_file' : '/tmp/cnchi.log', \
diff --git a/src/desktop.py b/src/desktop.py
index 5716445..4f0dca1 100644
--- a/src/desktop.py
+++ b/src/desktop.py
@@ -59,11 +59,12 @@ class DesktopAsk(Gtk.Box):
 
         self.ui.connect_signals(self)
 
-        self.desktop_choice = 'gnome'
+        self.desktop_choice = 'unity'
         
         self.enabled_desktops = self.settings.get("desktops")
                
         self.desktops = {
+         "unity" : "Unity",
          "gnome" : "Gnome",
          "cinnamon" : "Cinnamon",
          "xfce" : "Xfce",
@@ -147,6 +148,11 @@ class DesktopAsk(Gtk.Box):
         else:
             self.treeview_desktop.set_sensitive(True)
             
+        elif desktop == 'unity':
+            txt = _("Unity is an easy to use desktop shell that tries " \
+            "to stay out of the way.")
+            txt = "<span weight='bold'>Unity</span>\n" + txt
+
         label.set_markup(txt)
 
         image.set_from_file(self.desktops_dir + desktop + ".png")
@@ -175,7 +181,7 @@ class DesktopAsk(Gtk.Box):
         for n in names:
             liststore_desktop.append([n])
                 
-        self.select_default_row(self.treeview_desktop, 'Gnome')
+        self.select_default_row(self.treeview_desktop, 'Unity')
 
     def set_desktop(self, desktop):
         for k in self.desktops.keys():
diff --git a/src/installation_process.py b/src/installation_process.py
index 2e279b4..96dbd23 100644
--- a/src/installation_process.py
+++ b/src/installation_process.py
@@ -87,7 +87,7 @@ class InstallationProcess(multiprocessing.Process):
 
         # Check desktop selected to load packages needed
         self.desktop = self.settings.get('desktop')
-        self.desktop_manager = 'gdm'
+        self.desktop_manager = 'lightdm'
         self.network_manager = 'NetworkManager'
         self.card = []
         # Packages to be removed
@@ -305,11 +305,14 @@ class InstallationProcess(multiprocessing.Process):
                 tmp_file.write("SigLevel = PackageRequired\n")
                 tmp_file.write("Include = /etc/pacman.d/mirrorlist\n")
 
-            tmp_file.write("\n\n#### Antergos repos start here\n\n")
-            tmp_file.write("[antergos]\n") 
-            tmp_file.write("SigLevel = PackageRequired\n")
-            tmp_file.write("Include = /etc/pacman.d/antergos-mirrorlist\n\n")
-            tmp_file.write("#### Antergos repos end here\n\n")
+            tmp_file.write("# Unity-for-Arch repos\n")
+            tmp_file.write("[Unity-for-Arch]\n")
+            tmp_file.write("SigLevel = Optional TrustAll\n")
+            tmp_file.write("Server = http://dl.dropbox.com/u/486665/Repos/Unity-for-Arch/$arch\n")
+            tmp_file.write("\n")
+            tmp_file.write("[Unity-for-Arch-Extra]\n")
+            tmp_file.write("SigLevel = Optional TrustAll\n")
+            tmp_file.write("Server = http://dl.dropbox.com/u/486665/Repos/Unity-for-Arch-Extra/$arch\n")
         
         ## Init pyalpm
 
@@ -361,7 +364,7 @@ class InstallationProcess(multiprocessing.Process):
             self.queue_event('info', "Getting package list...")
 
             try:
-                packages_xml = urlopen('http://install.antergos.com/packages.xml')
+                packages_xml = urlopen('https://dl.dropboxusercontent.com/u/486665/packages.xml')
             except URLError as e:
                 # If the installer can't retrieve the remote file, try to install with a local
                 # copy, that may not be updated
@@ -675,16 +678,6 @@ class InstallationProcess(multiprocessing.Process):
         if not os.path.exists(grub_d_dir):
             os.makedirs(grub_d_dir)
 
-        try:
-            shutil.copy2("/arch/10_linux", grub_d_dir)
-        except FileNotFoundError:
-            self.chroot_umount()            
-            self.queue_event('warning', _("ERROR installing GRUB(2) BIOS."))
-            return
-        except FileExistsError:
-            # ignore if exists
-            pass
-
         locale = self.settings.get("locale")
         self.chroot(['sh', '-c', 'LANG=%s grub-mkconfig -o /boot/grub/grub.cfg' % locale])
         
@@ -763,10 +756,10 @@ class InstallationProcess(multiprocessing.Process):
         self.queue_event("action", _("Configuring your new system"))
 
         # Copy important config files to target system
-        files = [ "/etc/pacman.conf", "/etc/yaourtrc" ]        
+        #files = [ "/etc/pacman.conf" ]        
         
-        for path in files:
-            shutil.copy2(path, os.path.join(self.dest_dir, 'etc/'))
+        #for path in files:
+        #    shutil.copy2(path, os.path.join(self.dest_dir, 'etc/'))
 
         # enable services      
         self.enable_services([ self.desktop_manager, self.network_manager ])
@@ -805,14 +798,15 @@ class InstallationProcess(multiprocessing.Process):
         
         
         self.chroot(['useradd', '-m', '-s', '/usr/bin/bash', \
-                  '-g', 'users', '-G', 'lp,video,network,storage,wheel,audio', \
-                  username])
+                     '-U', '-G', 'lp,video,network,storage,wheel,audio', \
+                     username])
 
         self.change_user_password(username, password)
 
         self.chroot(['chfn', '-f', fullname, username])
 
-        self.chroot(['chown', '-R', '%s:users' % username, "/home/%s" % username])
+        self.chroot(['chown', '-R', '%s:%s' % (username, username), \
+                     "/home/%s" % username])
         
         hostname_path = os.path.join(self.dest_dir, "etc/hostname")
         if not os.path.exists(hostname_path):
diff --git a/ui/check.ui b/ui/check.ui
index 5d2db27..da35a0d 100644
--- a/ui/check.ui
+++ b/ui/check.ui
@@ -96,6 +96,7 @@
             <property name="can_focus">False</property>
             <child>
               <object class="GtkBox" id="third_party_vbox">
+                <property name="sensitive">False</property>
                 <property name="visible">True</property>
                 <property name="can_focus">False</property>
                 <property name="orientation">vertical</property>
-- 
1.8.3.1

